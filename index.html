<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Vezi Inscrieri</title>
    <link rel="stylesheet" href="style-inscrieri.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>

<div class="container">
    <h2>Vezi Tabele din Baza de Date</h2>

    <input id="filterInput" type="text" placeholder="Caută după numele tabelului...">

    <div class="sort-buttons">
    <button class="btn" onclick="sortAsc()">Sortare ↑</button>
<button class="btn" onclick="sortDesc()">Sortare ↓</button>
<button class="btn" onclick="exportTableToCSV('tabele.csv')">Export CSV</button>
<button class="btn" onclick="loadData()">Refresh</button>
</div>

    <div class="table-responsive">
        <table id="data-table">
            <thead>
                <tr>
                    <th>CATEGORIE</th>
                    <th>SPORTIVI INSCRISI</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
let tableData = [];

async function loadData() {
    try {
        const response = await fetch("https://sitedbsportdatamicro.onrender.com/victoria/vezi_inscrieri");
        if (!response.ok) throw new Error("Server error");
        const data = await response.json();
        console.log("Fetched data:", data);
        tableData = data;
        renderTable(data);
    } catch (err) {
        console.error("Eroare la încărcarea datelor:", err);
    }
}

function renderTable(data) {
    const tbody = document.querySelector("#data-table tbody");
    tbody.innerHTML = "";
    data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.tableName}</td><td style="text-align:right">${row.rowCount}</td>`;
        tbody.appendChild(tr);
    });
}

// Filtrare
document.getElementById("filterInput").addEventListener("keyup", function() {
    const value = this.value.toLowerCase();
    const filtered = tableData.filter(row => row.tableName.toLowerCase().includes(value));
    renderTable(filtered);
});

// Sortare
function sortAsc() {
    renderTable([...tableData].sort((a, b) => a.rowCount - b.rowCount));
}
function sortDesc() {
    renderTable([...tableData].sort((a, b) => b.rowCount - a.rowCount));
}

// Export CSV compatibil Excel
function exportTableToCSV(filename) { const csvRows = [["CATEGORIE", "SPORTIVI INSCRISI"]]; tableData.forEach(row => csvRows.push([row.tableName, row.rowCount])); const csvString = csvRows.map(e => e.join(",")).join("\n"); const blob = new Blob([csvString], { type: "text/csv" }); const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = filename; link.click(); }
setInterval(loadData, 30000);

// Load initial data
loadData();
</script>

</body>
</html>